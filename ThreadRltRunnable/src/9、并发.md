# 并发
- 同一个对象被多个线程同时操作

## 1、线程同步
- 由于同一进程的多个线程共享同一块资源存储空间，在带来方便的同时，也带来了访问冲突问题，为了保证数据在方法中被访问时的正确性，在访问时加入**锁机制synchronized**,当一个线程获得对象的排它锁，独占资源，其他线程必须等待，使用后释放锁即可，存在以下问题：
   1. 一个线程持有锁会导致其他所有需要此锁的线程挂起；
   2. 在多线程竞争下，加锁、释放锁会导致比较多的上下文切换和调度延时，引起性能问题；
   3. 如果一个优先级高的线程等待一个优先级低的线程释放锁，会导致优先级倒置，影响性能问题；

### 不安全的买票

```

public class SynchDemo01 {

    public static void main(String[] args) {
        BuyTicket buy = new BuyTicket();
        new Thread(buy, "小明").start();
        new Thread(buy, "小力").start();
        new Thread(buy, "小刚").start();
    }

}

class BuyTicket implements Runnable {

    //总票数
    int tickCount = 10;
    boolean flag = true;

    @Override
    public void run() {

        while (flag) {
            buy();
        }

    }

    //停止买票的条件
    public void buy() {
        if (tickCount <= 0) {
            System.out.println("买票结束");
            flag = false;
            return;
        }
        System.out.println(Thread.currentThread().getName() + "买到了第" + tickCount-- + "张票");

    }

}

```

### 不安全的取钱

```
public class SynchDemo02 {

    public static void main(String[] args) {
        Account account=new Account(100,"结婚基金");
        Drawing drawing=new Drawing(account,50,"小王");
        Drawing drawing2=new Drawing(account,100,"小李");

        drawing.start();
        drawing2.start();
    }

}

//账户
class Account{
  //余额
  int money;
  String name;//卡名

    public Account(int money,String name){
        this.money=money;
        this.name=name;
    }
}

//银行取钱
class Drawing extends Thread{

    Account account;//账户
    int drawingMoney;//取了多少钱
    int nowMoney;//手里多少钱

    public Drawing(Account account,int drawingMoney,String name){
        super(name);
        this.account=account;
        this.drawingMoney=drawingMoney;
    }

    @Override
    public void run() {
            //判断有没有钱
        if(account.money<drawingMoney){
            System.out.println("余额不足"+Thread.currentThread().getName()+"取不了");
            return;
        }else{
            nowMoney=nowMoney+drawingMoney;
            System.out.println(Thread.currentThread().getName()+"手里的钱有"+nowMoney);
            account.money=account.money-drawingMoney;
            System.out.println(account.name+"账户的余额为"+account.money);
        }
    }
}

```